<section class="signup-page">
  <app-header></app-header>
  
  <main class="signup-page__content">
    <section class="signup">
      <form class="signup__form" [formGroup]="signupForm" (ngSubmit)="onSubmit()" #formElement>
    <fieldset class="signup__fieldset">
      <legend>Ãšnete a MapMyJourney</legend>

      <!-- Name field -->
      <app-form-input
        label="Nombre Completo"
        type="text"
        placeholder="Ej: Juan GarcÃ­a"
        inputId="name"
        [control]="$any(signupForm.get('name'))">
      </app-form-input>

      <!-- Email field with async validation -->
      <app-form-input
        label="Email"
        type="email"
        placeholder="tu@email.com"
        inputId="email"
        [control]="$any(signupForm.get('email'))">
      </app-form-input>

      <!-- Password field with strength validation and toggle -->
      <div class="signup__password-group">
        <app-form-input
          label="ContraseÃ±a"
          [type]="showPassword ? 'text' : 'password'"
          placeholder="Min. 8 chars, mayÃºs., minÃºs., nÃºmero, especial"
          inputId="password"
          [control]="$any(signupForm.get('password'))">
        </app-form-input>
        <button
          type="button"
          (click)="togglePasswordVisibility()"
          class="signup__password-toggle"
          title="Mostrar/ocultar contraseÃ±a"
          tabindex="-1">
          @if (showPassword) {
            ğŸ‘ï¸
          } @else {
            ğŸ‘ï¸â€ğŸ—¨ï¸
          }
        </button>
      </div>

      <!-- Confirm password field with cross-field validation and toggle -->
      <div class="signup__password-group">
        <app-form-input
          label="Confirmar ContraseÃ±a"
          [type]="showConfirmPassword ? 'text' : 'password'"
          placeholder="Repite tu contraseÃ±a"
          inputId="confirmPassword"
          [control]="$any(signupForm.get('confirmPassword'))"
          [parentForm]="signupForm">
        </app-form-input>
        <button
          type="button"
          (click)="toggleConfirmPasswordVisibility()"
          class="signup__password-toggle"
          title="Mostrar/ocultar contraseÃ±a"
          tabindex="-1">
          @if (showConfirmPassword) {
            ğŸ‘ï¸
          } @else {
            ğŸ‘ï¸â€ğŸ—¨ï¸
          }
        </button>
      </div>

      <!-- Dynamic phone numbers FormArray -->
      <div class="signup__phones-section" formArrayName="phoneNumbers">
        <label class="signup__phones-label">NÃºmeros de TelÃ©fono (Opcional)</label>
        @for (phone of phoneNumbers.controls; let i = $index; track i) {
          <div class="signup__phone-item" [formGroupName]="i">
            <div class="signup__phone-input-wrapper">
              <input
                [formControlName]="'phone'"
                type="tel"
                placeholder="Ej: +34 123 456 789"
                class="signup__phone-input"
                [class.signup__phone-input--valid]="phone.valid && phone.value && phone.touched"
                [class.signup__phone-input--invalid]="phone.invalid && phone.touched">
              <div class="signup__phone-status">
                @if (phone.valid && phone.value && phone.touched) {
                  <span class="signup__phone-icon--valid">âœ“</span>
                }
                @if (phone.invalid && phone.value && phone.touched) {
                  <span class="signup__phone-icon--invalid">âœ•</span>
                }
              </div>
            </div>
            <button
              type="button"
              (click)="removePhoneNumber(i)"
              class="signup__phone-remove"
              title="Eliminar telÃ©fono">
              âœ• Eliminar
            </button>
          </div>
        }
        <button
          type="button"
          (click)="addPhoneNumber()"
          class="signup__phone-add">
          + Agregar telÃ©fono
        </button>
      </div>

      <!-- Terms acceptance checkbox -->
      <label class="signup__checkbox">
        <input
          type="checkbox"
          formControlName="acceptTerms"
          [class.signup__checkbox-input--invalid]="
            signupForm.get('acceptTerms')?.invalid &&
            signupForm.get('acceptTerms')?.touched
          ">
        <span>Acepto los <a href="/terminos">TÃ©rminos y Condiciones</a></span>
      </label>
      @if (
        signupForm.get('acceptTerms')?.invalid &&
        signupForm.get('acceptTerms')?.touched
      ) {
        <p class="signup__error">Debes aceptar los tÃ©rminos y condiciones</p>
      }

      <!-- Submit button -->
      <app-button
        label="Registrarse"
        variant="primary"
        size="lg"
        type="submit"
        [disabled]="!canSubmit">
      </app-button>

      <!-- Link to login -->
      <p class="signup__login-link">
        Â¿Ya tienes cuenta? <a routerLink="/auth/login">Inicia sesiÃ³n</a>
      </p>
    </fieldset>
  </form>
    </section>
  </main>

  <app-footer></app-footer>
</section>
